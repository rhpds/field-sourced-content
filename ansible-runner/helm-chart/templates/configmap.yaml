---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "ansible-runner.fullname" . }}-config
  namespace: {{ .Values.namespace.name }}
  labels:
    {{- include "ansible-runner.labels" . | nindent 4 }}
  annotations:
    argocd.argoproj.io/sync-wave: {{ .Values.syncWave.rbac | quote }}
data:
  # Ansible configuration
  ansible.cfg: |
    [defaults]
    host_key_checking = False
    stdout_callback = yaml
    library = /opt/ansible/library
    action_plugins = /opt/ansible/action_plugins
    filter_plugins = /opt/ansible/filter_plugins
    retry_files_enabled = False
    log_path = /tmp/ansible.log

    [inventory]
    enable_plugins = kubernetes.core.k8s

    [ssh_connection]
    pipelining = True

  # Python requirements for Ansible
  requirements.txt: |
    {{- range .Values.ansible.requirements }}
    {{ . }}
    {{- end }}

  # Ansible collections to install
  collections.txt: |
    {{- range .Values.ansible.collections }}
    {{ . }}
    {{- end }}

  # Example inventory
  inventory.yaml: |
    plugin: kubernetes.core.k8s
    connections:
      - kubeconfig: /tmp/kubeconfig